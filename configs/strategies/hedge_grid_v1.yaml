# Hedge Grid Strategy Configuration v1
# Research-optimized starting point (see docs/STRATEGY_PARAMETER_RESEARCH.md)

strategy:
  name: hedge_grid_v1
  instrument_id: BTCUSDT-PERP.BINANCE

# Grid Parameters (optimized for 1-minute bars and $10k account)
# Key change: Reduced levels from 7 to 6 for lower inventory
grid:
  grid_step_bps: 50.0        # Grid spacing in basis points (0.5%) - proven optimal for BTC
  grid_levels_long: 6        # Number of long grid levels below mid (reduced from 7)
  grid_levels_short: 6       # Number of short grid levels above mid (reduced from 7)
  base_qty: 0.002            # Base order quantity in BTC (~$180 at $90k)
  qty_scale: 1.05            # Quantity multiplier per level (5% geometric scaling)

# Take Profit / Stop Loss
# Key change: Increased TP from 2 to 3 for better risk/reward ratio
# Old: tp=2, sl=5 → 2.5:1 R/R (71% win rate needed)
# New: tp=3, sl=5 → 1.67:1 R/R (37% win rate needed)
exit:
  tp_steps: 3                # Take profit after 3 grid steps (was 2)
  sl_steps: 5                # Stop loss after 5 grid steps

# Grid Re-centering
# Key change: Reduced trigger from 300 to 200 for more responsive recentering
# Rule: recenter_trigger ≈ 4x grid_step (200 = 4x 50)
rebalance:
  recenter_trigger_bps: 200.0  # Re-center grid if price moves 2% from mid (was 3%)
  max_inventory_quote: 10000.0 # Max inventory in quote currency (USDT)

# Order Execution
execution:
  maker_only: true
  use_post_only_retries: true
  retry_attempts: 3
  retry_delay_ms: 100

# Funding Rate Filter
# Key change: Slightly increased threshold from 10 to 12 bps
funding:
  funding_window_minutes: 480  # 8-hour window for funding rate check
  funding_max_cost_bps: 12.0   # Max acceptable funding cost in bps per window (was 10)

# Regime Detection Parameters
# Key changes:
# - EMA fast: 12 → 10 (faster response)
# - EMA slow: 26 → 30 (wider spread for clearer signals)
# - Hysteresis: 50 → 35 (decoupled from grid_step to prevent oscillation)
regime:
  adx_len: 14                # ADX period for trend strength (standard)
  ema_fast: 10               # Fast EMA period (was 12 - faster response)
  ema_slow: 30               # Slow EMA period (was 26 - wider spread)
  atr_len: 14                # ATR period for volatility (standard)
  hysteresis_bps: 35.0       # Hysteresis band for regime switching (was 50 - decoupled from grid_step)

# Position Sizing
# Key change: Reduced max_position_pct from 0.8 to 0.75 for safety margin
position:
  max_position_size: 0.1     # Max position size in BTC
  max_position_pct: 0.75     # Max position as fraction of account balance (was 0.8)
  max_leverage_used: 5.0     # Max effective leverage
  emergency_liquidation_buffer: 0.15  # Keep 15% buffer from liquidation

# Placement Policy (Inventory Biasing by Regime)
# Key change: Reduced counter_levels from 5 to 4 for tighter throttling
policy:
  strategy: throttled-counter  # core-and-scalp or throttled-counter
  counter_levels: 4            # Number of counter-trend levels to maintain (was 5)
  counter_qty_scale: 0.5       # Scale counter-trend quantities by 50%
